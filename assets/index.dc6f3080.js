var ct=Object.defineProperty;var at=(t,e,i)=>e in t?ct(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var C=(t,e,i)=>(at(t,typeof e!="symbol"?e+"":e,i),i);const ft=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=i(r);fetch(r.href,n)}};ft();var x;(function(t){t[t.None=0]="None",t[t.Blend=1]="Blend",t[t.Add=2]="Add"})(x||(x={}));function P(t,e,i,s){var r=arguments.length,n=r<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;h>=0;h--)(o=t[h])&&(n=(r<3?o(n):r>3?o(e,i,n):o(e,i))||n);return r>3&&n&&Object.defineProperty(e,i,n),n}function a(t,e,i,s){return s===void 0&&(s=255),(t<<24)+(e<<16)+(i<<8)+s}const p={BLACK:a(0,0,0),WHITE:a(255,255,255),LIGHT_GRAY:a(170,170,170),DARK_GRAY:a(85,85,85),YELLOW:a(255,255,85),BROWN:a(170,85,0),LIGHT_RED:a(255,85,85),DARK_RED:a(170,0,0),LIGHT_GREEN:a(85,255,85),DARK_GREEN:a(0,170,0),LIGHT_CYAN:a(85,255,255),DARK_CYAN:a(0,170,170),LIGHT_BLUE:a(85,85,255),DARK_BLUE:a(0,0,170),LIGHT_MAGENTA:a(255,85,255),DARK_MAGENTA:a(170,0,170),ORANGE:a(255,136,0)},$=new Map;function R(t){$.set(t.name,t)}function Et(t){const e=[],i=new WeakMap,s=r(t);return JSON.stringify({instances:e,root:s});function r(_){return Array.isArray(_)?n(_):_&&typeof _=="object"?o(_):_}function n(_){const l=[];for(let c=0;c<_.length;c++)l[c]=r(_[c]);return l}function o(_){if(_&&_.constructor.name&&_.constructor.name!=="Object"){if(!$.has(_.constructor.name))throw new Error(`Class ${_.constructor.name} is not serializable.`);if(i.has(_))return{$ref:i.get(_)};const l=e.length;return e.push({$type:_.constructor.name}),i.set(_,l),e[l]=Object.assign(Object.assign({},h(_)),{$type:_.constructor.name}),{$ref:l}}return h(_)}function h(_){const l={};for(const c of Object.keys(_))l[c]=r(_[c]);return l}}function At(t){const e=JSON.parse(t),i=e.instances;for(let h=0;h<i.length;h++){const _=i[h],l=$.get(_.$type);delete _.$type,i[h]=Object.create(l.prototype,Object.getOwnPropertyDescriptors(_))}for(let h=0;h<i.length;h++)o(i[h]);return s(e.root);function s(h){return Array.isArray(h)?r(h):h&&typeof h=="object"?n(h):h}function r(h){for(let _=0;_<h.length;_++)h[_]=s(h[_]);return h}function n(h){return dt(h)?i[h.$ref]:(o(h),h)}function o(h){for(const[_,l]of Object.entries(h))h[_]=s(l)}}function dt(t){return!!(t&&typeof t=="object"&&"$ref"in t)}function ut(t){return typeof t=="string"&&t.length>0?t.charCodeAt(0):t}let w=class{constructor(e,i,s,r,n){this.x=e,this.y=i,s!==void 0?this.charCode=ut(s):this.charCode=" ".charCodeAt(0),r!==void 0?this.fg=r:this.fg=p.WHITE,n!==void 0?this.bg=n:this.bg=p.BLACK,this.dirty=!0,this.blocked=!1,this.blockedSight=!1,this.explored=!1,this.visible=!1,this.pathId=-1,this.g=0,this.h=0,this.prev=null}setCharCode(e){this.charCode!==e&&(this.charCode=e,this.dirty=!0)}setForeground(e){e!=null&&e!==this.fg&&(this.fg=e,this.dirty=!0)}setBackground(e){e!=null&&e!==this.bg&&(this.bg=e,this.dirty=!0)}setValue(e,i,s){return typeof e=="string"&&(e=e.charCodeAt(0)),typeof e=="number"?(this.setCharCode(e),i!==void 0&&this.setForeground(i),s!==void 0&&this.setBackground(s)):this.drawCell(e,x.None),this.dirty}drawCell(e,i){const s=e.bg&255;i===x.None||e.charCode>0?(this.setCharCode(e.charCode),this.setForeground(e.fg)):s>0&&s<255&&this.setForeground(this.blendColors(this.fg,e.bg,i)),i===x.None||s===255?this.setBackground(e.bg):s>0&&this.setBackground(this.blendColors(this.bg,e.bg,i))}blendColors(e,i,s){const r=i&255,n=(255-r)/255,o=1-n,h=e>>24&255,_=e>>16&255,l=e>>8&255,c=i>>24&255,E=i>>16&255,f=i>>8&255;switch(s){case x.Blend:return a(n*h+o*c|0,n*_+o*E|0,n*l+o*f|0);case x.Add:return a(this.clamp(h+o*c|0),this.clamp(_+o*E|0),this.clamp(l+o*f|0));default:return i}}clamp(e){return Math.min(255,e)}};w=P([R],w);var T;(function(t){t[t.SMILEY=1]="SMILEY",t[t.INVERSE_SMILEY=2]="INVERSE_SMILEY",t[t.HEART=3]="HEART",t[t.DIAMOND=4]="DIAMOND",t[t.CLUB=5]="CLUB",t[t.SPADE=6]="SPADE",t[t.BULLET=7]="BULLET",t[t.INVERSE_BULLET=8]="INVERSE_BULLET",t[t.LIGHT_SHADE=176]="LIGHT_SHADE",t[t.MEDIUM_SHADE=177]="MEDIUM_SHADE",t[t.DARK_SHADE=178]="DARK_SHADE",t[t.BOX_SINGLE_VERTICAL=179]="BOX_SINGLE_VERTICAL",t[t.BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT=180]="BOX_SINGLE_VERTICAL_AND_SINGLE_LEFT",t[t.BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT=185]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_LEFT",t[t.BOX_DOUBLE_VERTICAL=186]="BOX_DOUBLE_VERTICAL",t[t.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT=187]="BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT",t[t.BOX_DOUBLE_UP_AND_DOUBLE_LEFT=188]="BOX_DOUBLE_UP_AND_DOUBLE_LEFT",t[t.BOX_SINGLE_DOWN_AND_SINGLE_LEFT=191]="BOX_SINGLE_DOWN_AND_SINGLE_LEFT",t[t.BOX_SINGLE_UP_AND_SINGLE_RIGHT=192]="BOX_SINGLE_UP_AND_SINGLE_RIGHT",t[t.BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP=193]="BOX_SINGLE_HORIZONTAL_AND_SINGLE_UP",t[t.BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN=194]="BOX_SINGLE_HORIZONTAL_AND_SINGLE_DOWN",t[t.BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT=195]="BOX_SINGLE_VERTICAL_AND_SINGLE_RIGHT",t[t.BOX_SINGLE_HORIZONTAL=196]="BOX_SINGLE_HORIZONTAL",t[t.BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL=197]="BOX_SINGLE_VERTICAL_AND_SINGLE_HORIZONTAL",t[t.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT=200]="BOX_DOUBLE_UP_AND_DOUBLE_RIGHT",t[t.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT=201]="BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT",t[t.BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP=202]="BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_UP",t[t.BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN=203]="BOX_DOUBLE_HORIZONTAL_AND_DOUBLE_DOWN",t[t.BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT=204]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_RIGHT",t[t.BOX_DOUBLE_HORIZONTAL=205]="BOX_DOUBLE_HORIZONTAL",t[t.BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL=206]="BOX_DOUBLE_VERTICAL_AND_DOUBLE_HORIZONTAL",t[t.BOX_SINGLE_UP_AND_SINGLE_LEFT=217]="BOX_SINGLE_UP_AND_SINGLE_LEFT",t[t.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT=218]="BOX_SINGLE_DOWN_AND_SINGLE_RIGHT",t[t.BLOCK_FULL=219]="BLOCK_FULL",t[t.BLOCK_BOTTOM_HALF=220]="BLOCK_BOTTOM_HALF",t[t.BLOCK_LEFT_HALF=221]="BLOCK_LEFT_HALF",t[t.BLOCK_RIGHT_HALF=222]="BLOCK_RIGHT_HALF",t[t.BLOCK_TOP_HALF=223]="BLOCK_TOP_HALF"})(T||(T={}));function ht(t,e){const i=new RegExp("(\\S(.{0,"+e+"}\\S)?)\\s+","g");return(t+" ").replace(i,`$1
`).trim().split(`
`).map(s=>s.trim())}function q(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}let v=class{constructor(e,i,s){this.width=e,this.height=i,this.grid=[],this.originX=0,this.originY=0,this.minX=0,this.maxX=0,this.minY=0,this.maxY=0,this.radius=0;for(let r=0;r<i;r++){const n=[];for(let o=0;o<e;o++)n.push(new w(o,r));this.grid.push(n)}if(this.clear(),s)for(let r=0;r<i;r++)for(let n=0;n<e;n++)this.grid[r][n].blocked=this.grid[r][n].blockedSight=s(n,r)}clear(){for(let e=0;e<this.height;e++)for(let i=0;i<this.width;i++)this.drawChar(i,e,0)}getCell(e,i){if(!(e<0||i<0||e>=this.width||i>=this.height))return this.grid[i][e]}getCharCode(e,i){if(!(e<0||i<0||e>=this.width||i>=this.height))return this.grid[i][e].charCode}drawChar(e,i,s,r,n){this.clip&&!this.clip.contains({x:e,y:i})||e>=0&&e<this.width&&i>=0&&i<this.height&&this.grid[i|0][e|0].setValue(s,r,n)}drawString(e,i,s,r,n){const o=s.split(`
`);for(let h=0;h<o.length;h++)this.drawStringLine(e,i+h,o[h],r,n)}drawStringLine(e,i,s,r,n){for(let o=0;o<s.length;o++)this.drawChar(e+o,i,s.charCodeAt(o),r,n)}drawCenteredString(e,i,s,r,n){this.drawString(e-Math.floor(s.length/2),i,s,r,n)}drawMessage(e,i,s,r){if(s.text){const n=ht(s.text,r||this.width-e);for(const o of n)this.drawStringLine(e,i,o,s.fg,s.bg),i++}if(s.children)for(const n of s.children)i=this.drawMessage(e,i,n,r);return i}drawHLine(e,i,s,r,n,o){for(let h=e;h<e+s;h++)this.drawChar(h,i,r,n,o)}drawVLine(e,i,s,r,n,o){for(let h=i;h<i+s;h++)this.drawChar(e,h,r,n,o)}drawRect(e,i,s,r,n,o,h){this.drawHLine(e,i,s,n,o,h),this.drawHLine(e,i+r-1,s,n,o,h),this.drawVLine(e,i,r,n,o,h),this.drawVLine(e+s-1,i,r,n,o,h)}drawBox(e,i,s,r,n,o,h,_,l,c,E,f,L,g){this.fillRect(e,i,s,r,0,L,g),this.drawHLine(e,i,s,n),this.drawHLine(e,i+r-1,s,h),this.drawVLine(e,i,r,_),this.drawVLine(e+s-1,i,r,o),this.drawChar(e,i,l),this.drawChar(e+s-1,i,c),this.drawChar(e,i+r-1,f),this.drawChar(e+s-1,i+r-1,E)}drawSingleBox(e,i,s,r,n,o){this.drawBox(e,i,s,r,T.BOX_SINGLE_HORIZONTAL,T.BOX_SINGLE_VERTICAL,T.BOX_SINGLE_HORIZONTAL,T.BOX_SINGLE_VERTICAL,T.BOX_SINGLE_DOWN_AND_SINGLE_RIGHT,T.BOX_SINGLE_DOWN_AND_SINGLE_LEFT,T.BOX_SINGLE_UP_AND_SINGLE_LEFT,T.BOX_SINGLE_UP_AND_SINGLE_RIGHT,n,o)}drawDoubleBox(e,i,s,r,n,o){this.drawBox(e,i,s,r,T.BOX_DOUBLE_HORIZONTAL,T.BOX_DOUBLE_VERTICAL,T.BOX_DOUBLE_HORIZONTAL,T.BOX_DOUBLE_VERTICAL,T.BOX_DOUBLE_DOWN_AND_DOUBLE_RIGHT,T.BOX_DOUBLE_DOWN_AND_DOUBLE_LEFT,T.BOX_DOUBLE_UP_AND_DOUBLE_LEFT,T.BOX_DOUBLE_UP_AND_DOUBLE_RIGHT,n,o)}fillRect(e,i,s,r,n,o,h){for(let _=i;_<i+r;_++)this.drawHLine(e,_,s,n,o,h)}drawConsole(e,i,s,r,n,o,h,_){_=_||x.None;for(let l=0;l<h;l++)for(let c=0;c<o;c++){const E=s.getCell(r+c,n+l);E&&this.drawCell(e+c,i+l,E,_)}}drawCell(e,i,s,r){e>=0&&e<this.width&&i>=0&&i<this.height&&this.grid[i][e].drawCell(s,r)}setBlocked(e,i,s){e>=0&&e<this.width&&i>=0&&i<this.height&&(this.grid[i][e].blocked=s)}setBlockedSight(e,i,s){e>=0&&e<this.width&&i>=0&&i<this.height&&(this.grid[i][e].blockedSight=s)}isVisible(e,i){return e<this.minX||e>this.maxX||i<this.minY||i>this.maxY?!1:this.grid[i][e].visible}isBlocked(e,i){return e<0||e>this.width||i<0||i>this.height?!0:this.grid[i][e].blocked}isBlockedSight(e,i){return e<0||e>this.width||i<0||i>this.height?!0:this.grid[i][e].blockedSight}computeOctantY(e,i){const s=[],r=[];let n=1,o=0,h=0,_=0,l,c,E,f,L,g,V,O,u,S;for(c=this.originY+i;c>=this.minY&&c<=this.maxY;c+=i,h=o,++n)for(E=.5/n,S=-1,f=Math.floor(_*n+.5),l=this.originX+f*e;f<=n&&l>=this.minX&&l<=this.maxX;l+=e,++f,S=u){if(L=!0,g=!1,V=f/n,O=S,u=V+E,h>0){if(!(this.grid[c-i][l].visible&&!this.grid[c-i][l].blockedSight)&&!(this.grid[c-i][l-e].visible&&!this.grid[c-i][l-e].blockedSight))L=!1;else for(let d=0;d<h&&L;++d)if(O<=r[d]&&u>=s[d]){if(this.grid[c][l].blockedSight)if(O>=s[d]&&u<=r[d]){L=!1;break}else s[d]=Math.min(s[d],O),r[d]=Math.max(r[d],u),g=!0;else if(V>s[d]&&V<r[d]){L=!1;break}}}L&&(this.grid[c][l].visible=!0,this.grid[c][l].blockedSight&&(_>=O?_=u:g||(s[o]=O,r[o++]=u)))}}computeOctantX(e,i){const s=[],r=[];let n=1,o=0,h=0,_=0,l,c,E,f,L,g,V,O,u,S;for(l=this.originX+e;l>=this.minX&&l<=this.maxX;l+=e,h=o,++n)for(E=.5/n,S=-1,f=Math.floor(_*n+.5),c=this.originY+f*i;f<=n&&c>=this.minY&&c<=this.maxY;c+=i,++f,S=u){if(L=!0,g=!1,V=f/n,O=S,u=V+E,h>0){if(!(this.grid[c][l-e].visible&&!this.grid[c][l-e].blockedSight)&&!(this.grid[c-i][l-e].visible&&!this.grid[c-i][l-e].blockedSight))L=!1;else for(let d=0;d<h&&L;++d)if(O<=r[d]&&u>=s[d]){if(this.grid[c][l].blockedSight)if(O>=s[d]&&u<=r[d]){L=!1;break}else s[d]=Math.min(s[d],O),r[d]=Math.max(r[d],u),g=!0;else if(V>s[d]&&V<r[d]){L=!1;break}}}L&&(this.grid[c][l].visible=!0,this.grid[c][l].blockedSight&&(_>=O?_=u:g||(s[o]=O,r[o++]=u)))}}computeFov(e,i,s,r,n){if(this.originX=e,this.originY=i,this.radius=s,r)this.minX=Math.min(this.minX,Math.max(0,e-s)),this.minY=Math.min(this.minY,Math.max(0,i-s)),this.maxX=Math.max(this.maxX,Math.min(this.width-1,e+s)),this.maxY=Math.max(this.maxY,Math.min(this.height-1,i+s));else{this.minX=Math.max(0,e-s),this.minY=Math.max(0,i-s),this.maxX=Math.min(this.width-1,e+s),this.maxY=Math.min(this.height-1,i+s);for(let o=this.minY;o<=this.maxY;o++)for(let h=this.minX;h<=this.maxX;h++)this.grid[o][h].visible=!1}this.grid[i][e].visible=!0,n===void 0?(this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantX(1,-1),this.computeOctantY(1,-1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1),this.computeOctantX(-1,1),this.computeOctantY(-1,1)):(n&1&&this.computeOctantY(1,1),n&2&&this.computeOctantX(1,1),n&4&&this.computeOctantX(1,-1),n&8&&this.computeOctantY(1,-1),n&16&&this.computeOctantY(-1,-1),n&32&&this.computeOctantX(-1,-1),n&64&&this.computeOctantX(-1,1),n&128&&this.computeOctantY(-1,1))}updateExplored(){for(let e=this.minY;e<=this.maxY;e++)for(let i=this.minX;i<=this.maxX;i++){const s=this.grid[e][i];s.explored=s.explored||s.visible}}};v=P([R],v);class Ot{constructor(e,i,s,r,n){this.url=e,this.charWidth=i,this.charHeight=s,this.scale=r||1,this.graphical=!!n}}const Tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACAAQMAAAD58POIAAAABlBMVEUAAAD///+l2Z/dAAAEhklEQVRIx42Sv4oUQRDGC4UzadSwwMUD8QEKlbWD4Q58B/NGpTVocKO1wXHUzMAH0AcwMTYVGg5ag0IzEXaRjdZEZKNzkKbHqtnzHypY09M9+5uvqr7pbYCuC6ftaRhgONXs30eAh0O1rYDm4IS/eH0B8GxRW2vxo396yu/fb0ZFrW1zcOXlPU/XPwK8PGjbWhVwM4KnH61912oK4+zmmHJaQotyt1kvtC2Atdo24iohPDiG/v4eICJsY3Wy8Yvr0DSIBOdxgH6v8wsriWhc8s0AtaK/GzSl1jR0nSjQnwki6FQxNFKjgzO2a7BBqucH7dL4M9z96CIhT1Fs/AgKgcA6dKCxI29DaHNwRJ4EGAU1sU0OG9rmE4SIc3A4FChACqqhJRwpxkqh9wxag4DSmEJ5DtpFwAP4GUf6lmKcFFti1BYuQp4xN8kxM2kNhjdkTOiTUeAKGvhA1rLpMbYACQzCITlTDRMbLYoEa2JWPSMRFZIupcSzMVKcEUkX+sOG+ChNX2vD8ex6k7OFHL0P1655JuPd53WAD+yTv3UrCQiuHmYBbfIxpkImuvpBQBkVb5g4XHv3JkNireG8AO9zDhBZu2z2OMZ11S5/RIlyMefMNaZ4GsCz5xcjyM6hHYEjAYEfO8Ig1rklAe9sRIeYAdwyoIBq6YIzCAKiWoifA3m3o2AzWcdYKOdY47EIf8QABCuYgIUVmdVMEYEDA0Hmo/3D6KKJbh5mxhP3UsWIE97wnEygyizOfOLi2JOJW8CeOblW9IHeKZgv4zxuzDryOmb+4aQH+MXV6e0ywdUcxqCjBWl5GpbzZduOG1QEiGXP86T7EfiJfkMQ4OO4H0yqyNC2zlziWEN7Ywuc2fQ4p5BNkS5QYXP2h5NtRJh0vCKQidtVJmCGAwDSSQpYggSxiRIyzewsgCh4xxiTPDMh5aj//l7btqkr6rQyIOtLji4lVRQwXdzvus40Y53M33fh50GZwF4ExQeMlvuTggLzSi4ElKczUO7zVtpwdyMKdqZKOWb2nDblawPxPmuMwFEWBW+jlZR1eYtS442kiBGMWCi/h1/+GAR6NYOJWiqNJXFygFtrkx5C0O3IeFGs67HhEEhmBu/BUOT+0551pXxYIF+Elpi5AKRkLl5GUbCCZddyMv621ujEBPP4vSy2fotTx3U+d3WBiFOA6VSGSB49v/M7GBX9FPrDaT2c9qr4PCpwZ7qz813R94dVFIe19v33GlMZUghQFb8BrfE7QBmgBMbrn2B3enn/y3B5+DL8UBAdnejdYdBxeV9ejwoYNTgW0Ok/gA7UG2GAzanhL0DG7q4svynwF8UwDPu7u/vD0IudzSltMtVbP+J/gUbR29oJ7Fg9s6Uy+DnpiTCOYc4cXOeXMWfsusSw7FOg9x655nax6BlecwpOQQ68WBwp+H2LMQTuOq2RUigzh2Q/R3CWARJIJG199EwOTyKBlQMznshCRGeQ5gHABAQl6M4gLEdAzVaBWMCiANdsayDCHBA/hagKYfielrJIlipKKQIA9Nf3wBloTHT6BuAx15zRNa1nAAAAAElFTkSuQmCC",_t=new Ot(Tt,8,8);var st;(function(t){t[t.OCTANT_SOUTH_SOUTHEAST=1]="OCTANT_SOUTH_SOUTHEAST",t[t.OCTANT_EAST_SOUTHEAST=2]="OCTANT_EAST_SOUTHEAST",t[t.OCTANT_EAST_NORTHTHEAST=4]="OCTANT_EAST_NORTHTHEAST",t[t.OCTANT_NORTH_NORTHEAST=8]="OCTANT_NORTH_NORTHEAST",t[t.OCTANT_NORTH_NORTHWEST=16]="OCTANT_NORTH_NORTHWEST",t[t.OCTANT_WEST_NORTHEAST=32]="OCTANT_WEST_NORTHEAST",t[t.OCTANT_WEST_SOUTHWEST=64]="OCTANT_WEST_SOUTHWEST",t[t.OCTANT_SOUTH_SOUTHWEST=128]="OCTANT_SOUTH_SOUTHWEST"})(st||(st={}));var rt;(function(t){t[t.QUADRANT_SOUTHEAST=3]="QUADRANT_SOUTHEAST",t[t.QUADRANT_EAST=6]="QUADRANT_EAST",t[t.QUADRANT_NORTHEAST=12]="QUADRANT_NORTHEAST",t[t.QUADRANT_NORTH=24]="QUADRANT_NORTH",t[t.QUADRANT_NORTHWEST=48]="QUADRANT_NORTHWEST",t[t.QUADRANT_WEST=96]="QUADRANT_WEST",t[t.QUADRANT_SOUTHWEST=192]="QUADRANT_SOUTHWEST",t[t.QUADRANT_SOUTH=129]="QUADRANT_SOUTH"})(rt||(rt={}));let N=class{constructor(e,i){this.x=e,this.y=i}};N=P([R],N);let U=class{constructor(e,i,s,r){this.x=this.left=e,this.y=this.top=i,this.width=s,this.height=r,this.x2=e+s,this.y2=i+r}getCenter(){return new N(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(e){return this.x<=e.x2&&this.x2>=e.x&&this.y<=e.y2&&this.y2>=e.y}contains(e){return e.x>=this.x&&e.x<this.x2&&e.y>=this.y&&e.y<this.y2}};U=P([R],U);class Lt{constructor(e,i,s){this.dialog=e,this.rect=i,this.contentsOffset=s,this.open=!1,this.count=0}}class Vt{getState(e,i){const s=i.contentsRect.width+4,r=i.contentsRect.height+4,n=(e.width-s)/2|0,o=(e.height-r)/2|0;return new Lt(i,new U(n,o,s,r),new N(n+2,o+2))}draw(e,i){const s=i.dialog,{x:r,y:n,width:o,height:h}=i.rect;e.fillRect(r,n,o,h,0,p.WHITE,p.BLACK),e.drawSingleBox(r,n,o,h),e.drawCenteredString(r+o/2|0,n," "+s.title+" "),s.drawContents(e,i.contentsOffset)}}class Rt{constructor(e,i){this.terminal=e,this.renderer=i||new Vt,this.dialogs=[]}add(e){this.dialogs.push(this.renderer.getState(this.terminal,e))}handleInput(){if(this.dialogs.length===0)return!1;const e=this.dialogs.length-1,i=this.dialogs[this.dialogs.length-1];return i.dialog.handleInput(this.terminal,i.contentsOffset)&&this.dialogs.splice(e,1),!0}draw(){for(let e=0;e<this.dialogs.length;e++)this.renderer.draw(this.terminal,this.dialogs[e])}}class Nt{constructor(e,i){this.contentsRect=e,this.title=i}}let K=class{constructor(e,i,s,r){this.text=e,this.fg=i,this.bg=s,this.children=r}getWidth(){let e=0;if(this.text)for(const i of this.text.split(`
`))e=Math.max(e,i.length);if(this.children)for(const i of this.children)e=Math.max(e,i.getWidth());return e}getHeight(){let e=0;if(this.text&&(e+=this.text.split(`
`).length),this.children)for(const i of this.children)e+=i.getHeight();return e}};K=P([R],K);const gt=200,pt=1e3/15;class M{constructor(){this.down=!1,this.downTime=0,this.repeat=!1,this.repeatTime=0,this.downCount=0,this.upCount=100}setDown(e){this.down!==e&&(this.down=e,this.repeat=!1,this.downTime=this.repeatTime=performance.now())}update(e){this.repeat=!1,this.down?(this.downCount++,this.upCount=0,e-this.downTime>=gt&&e-this.repeatTime>=pt&&(this.repeat=!0,this.repeatTime=e)):(this.downCount=0,this.upCount++)}isPressed(){return this.downCount===1||this.repeat}isClicked(){return this.upCount===1}}const m=256;class Dt{constructor(e){this.keys=new Array(m);for(let i=0;i<m;i++)this.keys[i]=new M;e.addEventListener("keydown",i=>this.setKey(i,!0)),e.addEventListener("keyup",i=>this.setKey(i,!1))}setKey(e,i){const s=e.keyCode;s!==A.VK_F11&&(e.stopPropagation(),e.preventDefault(),s>=0&&s<m&&this.keys[s].setDown(i))}updateKeys(e){for(let i=0;i<m;i++)this.keys[i].update(e)}getKey(e){return e>=0&&e<m?this.keys[e]:null}}var A;(function(t){t[t.VK_CANCEL=3]="VK_CANCEL",t[t.VK_HELP=6]="VK_HELP",t[t.VK_BACK_SPACE=8]="VK_BACK_SPACE",t[t.VK_TAB=9]="VK_TAB",t[t.VK_CLEAR=12]="VK_CLEAR",t[t.VK_ENTER=13]="VK_ENTER",t[t.VK_SHIFT=16]="VK_SHIFT",t[t.VK_CONTROL=17]="VK_CONTROL",t[t.VK_ALT=18]="VK_ALT",t[t.VK_PAUSE=19]="VK_PAUSE",t[t.VK_CAPS_LOCK=20]="VK_CAPS_LOCK",t[t.VK_ESCAPE=27]="VK_ESCAPE",t[t.VK_SPACE=32]="VK_SPACE",t[t.VK_PAGE_UP=33]="VK_PAGE_UP",t[t.VK_PAGE_DOWN=34]="VK_PAGE_DOWN",t[t.VK_END=35]="VK_END",t[t.VK_HOME=36]="VK_HOME",t[t.VK_LEFT=37]="VK_LEFT",t[t.VK_UP=38]="VK_UP",t[t.VK_RIGHT=39]="VK_RIGHT",t[t.VK_DOWN=40]="VK_DOWN",t[t.VK_PRINTSCREEN=44]="VK_PRINTSCREEN",t[t.VK_INSERT=45]="VK_INSERT",t[t.VK_DELETE=46]="VK_DELETE",t[t.VK_0=48]="VK_0",t[t.VK_1=49]="VK_1",t[t.VK_2=50]="VK_2",t[t.VK_3=51]="VK_3",t[t.VK_4=52]="VK_4",t[t.VK_5=53]="VK_5",t[t.VK_6=54]="VK_6",t[t.VK_7=55]="VK_7",t[t.VK_8=56]="VK_8",t[t.VK_9=57]="VK_9",t[t.VK_COLON=58]="VK_COLON",t[t.VK_SEMICOLON=59]="VK_SEMICOLON",t[t.VK_LESS_THAN=60]="VK_LESS_THAN",t[t.VK_EQUALS=61]="VK_EQUALS",t[t.VK_GREATER_THAN=62]="VK_GREATER_THAN",t[t.VK_QUESTION_MARK=63]="VK_QUESTION_MARK",t[t.VK_AT=64]="VK_AT",t[t.VK_A=65]="VK_A",t[t.VK_B=66]="VK_B",t[t.VK_C=67]="VK_C",t[t.VK_D=68]="VK_D",t[t.VK_E=69]="VK_E",t[t.VK_F=70]="VK_F",t[t.VK_G=71]="VK_G",t[t.VK_H=72]="VK_H",t[t.VK_I=73]="VK_I",t[t.VK_J=74]="VK_J",t[t.VK_K=75]="VK_K",t[t.VK_L=76]="VK_L",t[t.VK_M=77]="VK_M",t[t.VK_N=78]="VK_N",t[t.VK_O=79]="VK_O",t[t.VK_P=80]="VK_P",t[t.VK_Q=81]="VK_Q",t[t.VK_R=82]="VK_R",t[t.VK_S=83]="VK_S",t[t.VK_T=84]="VK_T",t[t.VK_U=85]="VK_U",t[t.VK_V=86]="VK_V",t[t.VK_W=87]="VK_W",t[t.VK_X=88]="VK_X",t[t.VK_Y=89]="VK_Y",t[t.VK_Z=90]="VK_Z",t[t.VK_CONTEXT_MENU=93]="VK_CONTEXT_MENU",t[t.VK_NUMPAD0=96]="VK_NUMPAD0",t[t.VK_NUMPAD1=97]="VK_NUMPAD1",t[t.VK_NUMPAD2=98]="VK_NUMPAD2",t[t.VK_NUMPAD3=99]="VK_NUMPAD3",t[t.VK_NUMPAD4=100]="VK_NUMPAD4",t[t.VK_NUMPAD5=101]="VK_NUMPAD5",t[t.VK_NUMPAD6=102]="VK_NUMPAD6",t[t.VK_NUMPAD7=103]="VK_NUMPAD7",t[t.VK_NUMPAD8=104]="VK_NUMPAD8",t[t.VK_NUMPAD9=105]="VK_NUMPAD9",t[t.VK_MULTIPLY=106]="VK_MULTIPLY",t[t.VK_ADD=107]="VK_ADD",t[t.VK_SEPARATOR=108]="VK_SEPARATOR",t[t.VK_SUBTRACT=109]="VK_SUBTRACT",t[t.VK_DECIMAL=110]="VK_DECIMAL",t[t.VK_DIVIDE=111]="VK_DIVIDE",t[t.VK_F1=112]="VK_F1",t[t.VK_F2=113]="VK_F2",t[t.VK_F3=114]="VK_F3",t[t.VK_F4=115]="VK_F4",t[t.VK_F5=116]="VK_F5",t[t.VK_F6=117]="VK_F6",t[t.VK_F7=118]="VK_F7",t[t.VK_F8=119]="VK_F8",t[t.VK_F9=120]="VK_F9",t[t.VK_F10=121]="VK_F10",t[t.VK_F11=122]="VK_F11",t[t.VK_F12=123]="VK_F12",t[t.VK_F13=124]="VK_F13",t[t.VK_F14=125]="VK_F14",t[t.VK_F15=126]="VK_F15",t[t.VK_F16=127]="VK_F16",t[t.VK_F17=128]="VK_F17",t[t.VK_F18=129]="VK_F18",t[t.VK_F19=130]="VK_F19",t[t.VK_F20=131]="VK_F20",t[t.VK_F21=132]="VK_F21",t[t.VK_F22=133]="VK_F22",t[t.VK_F23=134]="VK_F23",t[t.VK_F24=135]="VK_F24",t[t.VK_NUM_LOCK=144]="VK_NUM_LOCK",t[t.VK_SCROLL_LOCK=145]="VK_SCROLL_LOCK",t[t.VK_CIRCUMFLEX=160]="VK_CIRCUMFLEX",t[t.VK_EXCLAMATION=161]="VK_EXCLAMATION",t[t.VK_DOUBLE_QUOTE=162]="VK_DOUBLE_QUOTE",t[t.VK_HASH=163]="VK_HASH",t[t.VK_DOLLAR=164]="VK_DOLLAR",t[t.VK_PERCENT=165]="VK_PERCENT",t[t.VK_AMPERSAND=166]="VK_AMPERSAND",t[t.VK_UNDERSCORE=167]="VK_UNDERSCORE",t[t.VK_OPEN_PAREN=168]="VK_OPEN_PAREN",t[t.VK_CLOSE_PAREN=169]="VK_CLOSE_PAREN",t[t.VK_ASTERISK=170]="VK_ASTERISK",t[t.VK_PLUS=171]="VK_PLUS",t[t.VK_PIPE=172]="VK_PIPE",t[t.VK_HYPHEN_MINUS=173]="VK_HYPHEN_MINUS",t[t.VK_OPEN_CURLY_BRACKET=174]="VK_OPEN_CURLY_BRACKET",t[t.VK_CLOSE_CURLY_BRACKET=175]="VK_CLOSE_CURLY_BRACKET",t[t.VK_TILDE=176]="VK_TILDE",t[t.VK_COMMA=188]="VK_COMMA",t[t.VK_PERIOD=190]="VK_PERIOD",t[t.VK_SLASH=191]="VK_SLASH",t[t.VK_BACK_QUOTE=192]="VK_BACK_QUOTE",t[t.VK_OPEN_BRACKET=219]="VK_OPEN_BRACKET",t[t.VK_BACK_SLASH=220]="VK_BACK_SLASH",t[t.VK_CLOSE_BRACKET=221]="VK_CLOSE_BRACKET",t[t.VK_QUOTE=222]="VK_QUOTE",t[t.VK_META=224]="VK_META",t[t.VK_ALTGR=225]="VK_ALTGR",t[t.VK_WIN=91]="VK_WIN",t[t.VK_KANA=21]="VK_KANA",t[t.VK_HANGUL=21]="VK_HANGUL",t[t.VK_EISU=22]="VK_EISU",t[t.VK_JUNJA=23]="VK_JUNJA",t[t.VK_FINAL=24]="VK_FINAL",t[t.VK_HANJA=25]="VK_HANJA",t[t.VK_KANJI=25]="VK_KANJI",t[t.VK_CONVERT=28]="VK_CONVERT",t[t.VK_NONCONVERT=29]="VK_NONCONVERT",t[t.VK_ACCEPT=30]="VK_ACCEPT",t[t.VK_MODECHANGE=31]="VK_MODECHANGE",t[t.VK_SELECT=41]="VK_SELECT",t[t.VK_PRINT=42]="VK_PRINT",t[t.VK_EXECUTE=43]="VK_EXECUTE",t[t.VK_SLEEP=95]="VK_SLEEP"})(A||(A={}));class xt extends Nt{constructor(e,i,s){super(e,i),this.message=s,this.scrollY=0,this.messagesHeight=s.getHeight(),this.scrollMax=Math.max(1,this.messagesHeight-this.contentsRect.height),this.scrollbarHeight=this.contentsRect.height*this.contentsRect.height/(this.messagesHeight+1)}drawContents(e,i){e.clip=this.contentsRect,e.drawMessage(i.x,i.y-this.scrollY,this.message),e.clip=void 0;const s=this.scrollY/this.scrollMax*(this.contentsRect.height-this.scrollbarHeight);e.drawVLine(this.contentsRect.x+this.contentsRect.width+1,this.contentsRect.y+s,this.scrollbarHeight,T.MEDIUM_SHADE)}handleInput(e){const i=e.getMovementKey();return i&&(this.scrollY+=i.y),e.isKeyPressed(A.VK_PAGE_DOWN)&&(this.scrollY+=this.contentsRect.height),e.isKeyPressed(A.VK_PAGE_UP)&&(this.scrollY-=this.contentsRect.height),e.mouse.wheelDeltaY!==0&&(this.scrollY+=e.mouse.wheelDeltaY<0?-5:5,e.mouse.wheelDeltaY=0),this.scrollY=Math.max(0,Math.min(this.scrollMax,this.scrollY)),e.isKeyPressed(A.VK_ESCAPE)}}T.BLOCK_TOP_HALF,T.BLOCK_RIGHT_HALF;class St{constructor(e){this.el=e.canvas,this.width=e.width,this.height=e.height,this.prevX=0,this.prevY=0,this.x=0,this.y=0,this.dx=0,this.dy=0,this.wheelDeltaX=0,this.wheelDeltaY=0,this.buttons=[new M,new M,new M];const i=this.el;i.addEventListener("mousedown",s=>this.handleEvent(s)),i.addEventListener("mouseup",s=>this.handleEvent(s)),i.addEventListener("mousemove",s=>this.handleEvent(s)),i.addEventListener("contextmenu",s=>this.handleEvent(s)),i.addEventListener("touchstart",s=>this.handleTouchEvent(s)),i.addEventListener("touchend",s=>this.handleTouchEvent(s)),i.addEventListener("touchcancel",s=>this.handleTouchEvent(s)),i.addEventListener("touchmove",s=>this.handleTouchEvent(s)),i.addEventListener("wheel",s=>this.handleWheelEvent(s))}handleTouchEvent(e){if(e.stopPropagation(),e.preventDefault(),e.touches.length>0){const i=e.touches[0];this.updatePosition(i.clientX,i.clientY),this.buttons[0].setDown(!0)}else this.buttons[0].setDown(!1)}handleEvent(e){e.stopPropagation(),e.preventDefault(),this.updatePosition(e.clientX,e.clientY),e.type==="mousedown"&&(this.buttons[e.button].setDown(!0),this.el.focus()),e.type==="mouseup"&&this.buttons[e.button].setDown(!1)}handleWheelEvent(e){e.stopPropagation(),e.preventDefault(),this.wheelDeltaX=e.deltaX,this.wheelDeltaY=e.deltaY}updatePosition(e,i){let s=this.el.getBoundingClientRect();const r=this.width/this.height,n=s.width/s.height;if(n-r>.01){const o=r*s.height,h=s.width-o;s=new U(Math.floor(h/2),0,o,s.height)}if(n-r<-.01){const o=s.width/r,h=s.height-o;s=new U(0,Math.floor(h/2),s.width,o)}this.x=this.width*(e-s.left)/s.width|0,this.y=this.height*(i-s.top)/s.height|0}update(e){this.dx=this.x-this.prevX,this.dy=this.y-this.prevY,this.prevX=this.x,this.prevY=this.y;for(let i=0;i<this.buttons.length;i++)this.buttons[i].update(e)}}const nt=[-1,0,1,-1,1,-1,0,1],Ut=[-1,-1,-1,0,0,1,1,1],It=[1.4,1,1.4,1,1,1.4,1,1.4];let H=0;function mt(t,e,i,s){H++;const r=t.grid[e.y][e.x];r.pathId=H,r.g=0,r.h=Math.hypot(e.x-i.x,e.y-i.y),r.prev=null;const n=new wt([r]);for(;n.size()>0;){const o=n.pop();if(o.x===i.x&&o.y===i.y)return Bt(o);for(let h=0;h<nt.length;h++){const _=o.x+nt[h],l=o.y+Ut[h];if(_>=0&&_<t.width&&l>=0&&l<t.height){const c=t.grid[l][_];if(c.blocked&&c.explored&&(_!==i.x||l!==i.y))continue;c.pathId!==H&&(c.pathId=H,c.g=1/0,c.h=Math.hypot(_-i.x,l-i.y),c.prev=null);const E=o.g+It[h];E<c.g&&E<=s&&(c.g=E,c.prev=o,n.insert(c))}}}}function Bt(t){const e=[];let i=t;for(;i;)e.push(i),i=i.prev;return e.reverse(),e}class wt{constructor(e){this.values=e}insert(e){const i=this.values;let s=0,r=i.length,n=0;for(;s<r;){const o=s+r>>>1,h=i[o];h.g+h.h>e.g+e.h?(s=o+1,n=s):(r=o,n=r)}i.splice(n,0,e)}pop(){return this.values.pop()}size(){return this.values.length}}class Pt{constructor(e){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=e||1}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(e,i){const s=i-e,r=this.nextInt()/this.m,n=e+(r*s|0);if(isNaN(n))throw new Error("rand nan");return n}chooseIndex(e){const i=e.reduce((n,o)=>n+o),s=this.nextRange(1,i+1);let r=0;for(let n=0;n<e.length;n++)if(r+=e[n],s<=r)return n;return e.length-1}chooseKey(e){const i=Object.keys(e),s=i.map(r=>e[r]);return i[this.chooseIndex(s)]}}const Ct=`#version 300 es
precision highp float;in vec2 a;in vec2 b;in vec3 c;in vec3 d;out vec2 e;out vec4 f;out vec4 g;void main(void){gl_Position=vec4(a.x,a.y,0,1);e=b/16.0;f=vec4(c.r,c.g,c.b,1);g=vec4(d.r,d.g,d.b,1);}`,Ht=`#version 300 es
precision highp float;in vec2 e;in vec4 f;in vec4 g;uniform bool h;uniform sampler2D s;out vec4 o;void main(void){o=texture(s,e);if(h){if(o.a<0.1){o=texture(s,g.rg*16.0+fract(e*16.0)/16.0);}}else{if(o.r<0.1) {o=g;} else {o=f;}}}`;function D(t,e){return-1+2*(t/e)}const Mt={font:_t};class bt extends v{constructor(e,i,s,r){super(i,s),r=r||Mt,this.canvas=e,this.font=r.font||_t,this.pixelWidth=i*this.font.charWidth,this.pixelHeight=s*this.font.charHeight,e.width=this.pixelWidth,e.height=this.pixelHeight,e.style.imageRendering="pixelated",e.style.outline="none",e.tabIndex=0,this.handleResize(),window.addEventListener("resize",()=>this.handleResize()),this.keys=new Dt(e),this.mouse=new St(this);const n=e.getContext("webgl2",{antialias:!1});if(!n)throw new Error("Unable to initialize WebGL. Your browser may not support it.");const o=n.createProgram();if(!o)throw new Error("Unable to initialize WebGL. Your browser may not support it.");this.gl=n,this.program=o,n.attachShader(o,this.buildShader(n.VERTEX_SHADER,Ct)),n.attachShader(o,this.buildShader(n.FRAGMENT_SHADER,Ht)),n.linkProgram(o),n.useProgram(o),this.font.graphical&&n.uniform1i(n.getUniformLocation(o,"h"),1),this.positionAttribLocation=this.getAttribLocation("a"),this.textureAttribLocation=this.getAttribLocation("b"),this.fgColorAttribLocation=this.getAttribLocation("c"),this.bgColorAttribLocation=this.getAttribLocation("d");const h=i*s;this.positionsArray=new Float32Array(h*3*4),this.indexArray=new Uint16Array(h*6),this.textureArray=new Float32Array(h*2*4),this.foregroundUint8Array=new Uint8Array(h*4*4),this.foregroundDataView=new DataView(this.foregroundUint8Array.buffer),this.backgroundUint8Array=new Uint8Array(h*4*4),this.backgroundDataView=new DataView(this.backgroundUint8Array.buffer);let _=0,l=0,c=0;for(let E=0;E<s;E++)for(let f=0;f<i;f++)this.positionsArray[_++]=D(f,i),this.positionsArray[_++]=-D(E,s),this.positionsArray[_++]=D(f+1,i),this.positionsArray[_++]=-D(E,s),this.positionsArray[_++]=D(f+1,i),this.positionsArray[_++]=-D(E+1,s),this.positionsArray[_++]=D(f,i),this.positionsArray[_++]=-D(E+1,s),this.indexArray[l++]=c+0,this.indexArray[l++]=c+1,this.indexArray[l++]=c+2,this.indexArray[l++]=c+0,this.indexArray[l++]=c+2,this.indexArray[l++]=c+3,c+=4;this.positionBuffer=n.createBuffer(),this.indexBuffer=n.createBuffer(),this.textureBuffer=n.createBuffer(),this.foregroundBuffer=n.createBuffer(),this.backgroundBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.positionBuffer),n.bufferData(n.ARRAY_BUFFER,this.positionsArray,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indexArray,n.STATIC_DRAW),this.texture=this.loadTexture(this.font.url),this.lastRenderTime=0,this.renderDelta=0,this.fps=0,this.averageFps=0,this.requestAnimationFrame()}handleResize(){const e=this.canvas.parentElement;if(!e)return;const i=e.offsetWidth/this.pixelWidth,s=e.offsetHeight/this.pixelHeight,r=Math.min(i,s),n=r*this.pixelWidth|0,o=r*this.pixelHeight|0;this.canvas.style.width=n+"px",this.canvas.style.height=o+"px"}getAttribLocation(e){const i=this.gl.getAttribLocation(this.program,e);return this.gl.enableVertexAttribArray(i),i}flush(){let e=0,i=0;for(let s=0;s<this.height;s++)for(let r=0;r<this.width;r++){const n=this.getCell(r,s);if(!n.dirty){e+=8,i+=16;continue}const o=n.charCode%16,h=n.charCode/16|0;this.textureArray[e++]=o,this.textureArray[e++]=h,this.textureArray[e++]=o+1,this.textureArray[e++]=h,this.textureArray[e++]=o+1,this.textureArray[e++]=h+1,this.textureArray[e++]=o,this.textureArray[e++]=h+1;for(let _=0;_<4;_++)this.foregroundDataView.setUint32(i,n.fg,!1),this.backgroundDataView.setUint32(i,n.bg,!1),i+=4;n.dirty=!1}}isKeyDown(e){const i=this.keys.getKey(e);return!!i&&i.down}isKeyPressed(e){const i=this.keys.getKey(e);return!!i&&i.isPressed()}getKeyDownCount(e){const i=this.keys.getKey(e);return i?i.downCount:0}getMovementKey(){if(this.isKeyPressed(A.VK_NUMPAD1)||this.isKeyPressed(A.VK_B))return new N(-1,1);if(this.isKeyPressed(A.VK_NUMPAD2)||this.isKeyPressed(A.VK_J)||this.isKeyPressed(A.VK_DOWN))return new N(0,1);if(this.isKeyPressed(A.VK_NUMPAD3)||this.isKeyPressed(A.VK_N))return new N(1,1);if(this.isKeyPressed(A.VK_NUMPAD4)||this.isKeyPressed(A.VK_H)||this.isKeyPressed(A.VK_LEFT))return new N(-1,0);if(this.isKeyPressed(A.VK_NUMPAD5)||this.isKeyPressed(A.VK_PERIOD))return new N(0,0);if(this.isKeyPressed(A.VK_NUMPAD6)||this.isKeyPressed(A.VK_L)||this.isKeyPressed(A.VK_RIGHT))return new N(1,0);if(this.isKeyPressed(A.VK_NUMPAD7)||this.isKeyPressed(A.VK_Y))return new N(-1,-1);if(this.isKeyPressed(A.VK_NUMPAD8)||this.isKeyPressed(A.VK_K)||this.isKeyPressed(A.VK_UP))return new N(0,-1);if(this.isKeyPressed(A.VK_NUMPAD9)||this.isKeyPressed(A.VK_U))return new N(1,-1)}buildShader(e,i){const s=this.gl,r=s.createShader(e);if(!r)throw new Error("An error occurred compiling the shader: ");if(s.shaderSource(r,i),s.compileShader(r),!s.getShaderParameter(r,s.COMPILE_STATUS))throw new Error("An error occurred compiling the shader: "+s.getShaderInfoLog(r));return r}loadTexture(e){const i=this.gl,s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s);const r=0,n=i.RGBA,o=1,h=1,_=0,l=i.RGBA,c=i.UNSIGNED_BYTE,E=new Uint8Array([0,0,0,255]);i.texImage2D(i.TEXTURE_2D,r,n,o,h,_,l,c,E);const f=new Image;return f.onload=()=>{i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,r,n,l,c,f),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)},f.src=e,s}render(){const e=this.gl;e.clearColor(0,0,0,1),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.viewport(0,0,this.pixelWidth,this.pixelHeight);{const s=e.FLOAT,r=!1,n=0,o=0;e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),e.vertexAttribPointer(this.positionAttribLocation,2,s,r,n,o)}{const s=e.FLOAT,r=!1,n=0,o=0;e.bindBuffer(e.ARRAY_BUFFER,this.textureBuffer),e.bufferData(e.ARRAY_BUFFER,this.textureArray,e.DYNAMIC_DRAW),e.vertexAttribPointer(this.textureAttribLocation,2,s,r,n,o)}{const s=e.UNSIGNED_BYTE,r=!0,n=0,o=0;e.bindBuffer(e.ARRAY_BUFFER,this.foregroundBuffer),e.bufferData(e.ARRAY_BUFFER,this.foregroundUint8Array,e.DYNAMIC_DRAW),e.vertexAttribPointer(this.fgColorAttribLocation,4,s,r,n,o)}{const s=e.UNSIGNED_BYTE,r=!0,n=0,o=0;e.bindBuffer(e.ARRAY_BUFFER,this.backgroundBuffer),e.bufferData(e.ARRAY_BUFFER,this.backgroundUint8Array,e.DYNAMIC_DRAW),e.vertexAttribPointer(this.bgColorAttribLocation,4,s,r,n,o)}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.useProgram(this.program),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture);{const i=this.width*this.height*6,s=e.UNSIGNED_SHORT,r=0;e.drawElements(e.TRIANGLES,i,s,r)}}requestAnimationFrame(){window.requestAnimationFrame(e=>this.renderLoop(e))}renderLoop(e){this.lastRenderTime===0?(this.lastRenderTime=e,this.fps=0):(this.renderDelta=e-this.lastRenderTime,this.lastRenderTime=e,this.fps=1e3/this.renderDelta,this.averageFps=.95*this.averageFps+.05*this.fps),this.keys.updateKeys(e),this.mouse.update(e),this.update&&this.update(),this.flush(),this.render(),this.requestAnimationFrame()}}const Y=a(255,255,255);a(0,0,0);const vt=a(224,224,224),Kt=a(255,192,192),Gt=a(255,48,48),Ft=a(255,160,48),Xt=a(32,160,255),W=Y,Yt=a(0,96,0),Wt=a(64,16,16);var kt=Object.defineProperty,zt=Object.getOwnPropertyDescriptor,jt=(t,e,i,s)=>{for(var r=s>1?void 0:s?zt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(r=(s?o(e,i,r):o(r))||r);return s&&r&&kt(e,i,r),r};const ot={CORPSE:0,ITEM:1,ACTOR:2};let z=class{constructor(t,e,i,s,r,n=!1,o=0){this.x=t,this.y=e,this.char=i,this.color=s,this.name=r,this.blocks=n,this.renderOrder=o}spawn(t,e,i){const s=At(Et(this));return s.x=e,s.y=i,t.entities.push(s),s}move(t,e){this.x+=t,this.y+=e}};z=jt([R],z);var Qt=Object.defineProperty,Zt=Object.getOwnPropertyDescriptor,Jt=(t,e,i,s)=>{for(var r=s>1?void 0:s?Zt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(r=(s?o(e,i,r):o(r))||r);return s&&r&&Qt(e,i,r),r};let I=class extends z{constructor(t,e,i,s,r,n,o,h,_,l,c){super(t,e,i,s,r,n),this.maxHp=o,this.hp_=h,this.defense=_,this.power=l,this.ai=c,this.renderOrder=ot.ACTOR}get hp(){return this.hp_}addHp(t,e){this.hp_=Math.max(0,Math.min(this.hp_+e,this.maxHp)),this.hp_===0&&this.die(t)}die(t){this===t.player?t.log("You died!",Gt):t.log(`${q(this.name)} is dead!`,Ft),this.char="%",this.color=a(191,0,0),this.blocks=!1,this.ai=void 0,this.name="remains of "+this.name,this.renderOrder=ot.CORPSE}};I=Jt([R],I);var $t=Object.defineProperty,qt=Object.getOwnPropertyDescriptor,y=(t,e,i,s)=>{for(var r=s>1?void 0:s?qt(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(r=(s?o(e,i,r):o(r))||r);return s&&r&&$t(e,i,r),r};class yt{constructor(e){this.actor=e}}class tt extends yt{constructor(e,i,s){super(e),this.dx=i,this.dy=s}}let G=class extends tt{perform(t){const e=this.actor.x+this.dx,i=this.actor.y+this.dy,s=t.gameMap.getActor(e,i);if(!s)return;const r=this.actor.power-s.defense,n=q(this.actor.name)+" attacks "+s.name,o=this.actor===t.player?vt:Kt;r>0?(t.log(n+" for "+r+" hit points!",o),s.addHp(t,-r)):console.log(n+" but does no damage.",o)}};G=y([R],G);let F=class extends tt{perform(t){const e=this.actor.x+this.dx,i=this.actor.y+this.dy;t.gameMap.isWall(e,i)||t.gameMap.getBlockingEntity(e,i)||this.actor.move(this.dx,this.dy)}};F=y([R],F);let j=class extends tt{perform(t){if(this.dx===0&&this.dy===0)return;const e=this.actor.x+this.dx,i=this.actor.y+this.dy;return t.gameMap.getActor(e,i)?new G(this.actor,this.dx,this.dy).perform(t):new F(this.actor,this.dx,this.dy).perform(t)}};j=y([R],j);var te=Object.defineProperty,ee=Object.getOwnPropertyDescriptor,ie=(t,e,i,s)=>{for(var r=s>1?void 0:s?ee(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(r=(s?o(e,i,r):o(r))||r);return s&&r&&te(e,i,r),r};let Q=class{constructor(){C(this,"messages",[])}add(t,e=Y){this.messages.push(new K(t,e))}render(t,e,i,s,r){let n=r-1;for(let o=this.messages.length-1;o>=0&&n>=0;o--){const h=this.messages[o],_=ht(h.text,s).reverse();for(const l of _)t.drawString(e,i+n,l,h.fg),n--}}};Q=ie([R],Q);function se(t,e,i,s){const r=Math.round(e/i*s);t.fillRect(0,40,s,1," ",W,Wt),t.fillRect(0,40,r,1," ",W,Yt),t.drawString(0,40,`HP: ${e}/${i}`,W)}function re(t,e,i,s){t.drawString(21,39,q(e.entities.filter(r=>r.x===i&&r.y===s).map(r=>r.name).join(", ")),Y)}var ne=Object.defineProperty,oe=Object.getOwnPropertyDescriptor,he=(t,e,i,s)=>{for(var r=s>1?void 0:s?oe(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(r=(s?o(e,i,r):o(r))||r);return s&&r&&ne(e,i,r),r};let Z=class{constructor(t,e){C(this,"messageLog",new Q);this.player=t,this.gameMap=e,this.updateFov()}log(t,e=Y){this.messageLog.add(t,e)}handleEnemyTurns(){this.gameMap.actors.forEach(t=>{var e;return(e=t.ai)==null?void 0:e.perform(this,t)})}handleEvents(t){let e;if(this.player.hp>0){const i=t.getMovementKey();i&&(e=new j(this.player,i.x,i.y))}e&&(e.perform(this),this.handleEnemyTurns(),this.updateFov())}updateFov(){this.gameMap.updateFov(this.player.x,this.player.y)}render(t){t.clear(),this.gameMap.render(t),this.messageLog.render(t,21,40,40,5),se(t,this.player.hp,this.player.maxHp,20),re(t,this.gameMap,t.mouse.x,t.mouse.y)}};Z=he([R],Z);var _e=Object.defineProperty,le=Object.getOwnPropertyDescriptor,ce=(t,e,i,s)=>{for(var r=s>1?void 0:s?le(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(r=(s?o(e,i,r):o(r))||r);return s&&r&&_e(e,i,r),r};class ae{walkToward(e,i,s){const r=e.gameMap.computePath(i,s);if(r){const n=r[1],o=n.x-i.x,h=n.y-i.y;new F(i,o,h).perform(e)}}}let X=class extends ae{perform(t,e){const i=t.player,s=i.x-e.x,r=i.y-e.y,n=Math.max(Math.abs(s),Math.abs(r));if(!!t.gameMap.isVisible(e.x,e.y)){if(n<=1){new G(e,s,r).perform(t);return}this.walkToward(t,e,i)}}};X=ce([R],X);const fe=new I(0,0,"o",a(63,127,63),"orc",!0,10,10,0,3,new X),Ee=new I(0,0,"T",a(0,127,0),"troll",!0,16,16,1,4,new X),Ae=new w(0,0," ",p.WHITE,p.LIGHT_BLUE),de=new w(0,0," ",p.WHITE,p.DARK_BLUE);var ue=Object.defineProperty,Oe=Object.getOwnPropertyDescriptor,Te=(t,e,i,s)=>{for(var r=s>1?void 0:s?Oe(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(r=(s?o(e,i,r):o(r))||r);return s&&r&&ue(e,i,r),r};const Le=a(0,0,100),Ve=a(130,110,50),Re=a(50,50,150),Ne=a(200,180,50);let J=class{constructor(t,e,i){C(this,"console");this.width=t,this.height=e,this.entities=i,this.console=new v(t,e);for(let s=0;s<e;s++)for(let r=0;r<t;r++)this.makeWall(r,s)}get actors(){return this.entities.filter(t=>t instanceof I&&t.blocks)}createRoom(t){for(let e=t.y+1;e<t.y2;e++)for(let i=t.x+1;i<t.x2;i++)this.makeFloor(i,e)}createHTunnel(t,e,i){for(let s=Math.min(t,e);s<=Math.max(t,e);s++)this.makeFloor(s,i)}createVTunnel(t,e,i){for(let s=Math.min(t,e);s<=Math.max(t,e);s++)this.makeFloor(i,s)}updateFov(t,e){this.console.computeFov(t,e,8),this.console.updateExplored()}isVisible(t,e){return this.console.isVisible(t,e)}isWall(t,e){return this.console.isBlocked(t,e)}getBlockingEntity(t,e){return this.entities.find(i=>i.blocks&&i.x===t&&i.y===e)}getActor(t,e){return this.actors.find(i=>i.x===t&&i.y===e)}computePath(t,e){return mt(this.console,t,e,1e3)}render(t){for(let e=0;e<this.height;e++)for(let i=0;i<this.width;i++){const s=this.isVisible(i,e),r=this.console.grid[e][i].blockedSight;let n=p.BLACK;s?n=r?Ve:Ne:this.console.grid[e][i].explored&&(n=r?Le:Re),t.drawChar(i,e,0,0,n)}this.entities.sort((e,i)=>e.renderOrder-i.renderOrder);for(const e of this.entities)this.isVisible(e.x,e.y)&&t.drawChar(e.x,e.y,e.char,e.color)}makeWall(t,e){this.console.drawCell(t,e,de),this.console.setBlocked(t,e,!0),this.console.setBlockedSight(t,e,!0)}makeFloor(t,e){this.console.drawCell(t,e,Ae),this.console.setBlocked(t,e,!1),this.console.setBlockedSight(t,e,!1)}};J=Te([R],J);function ge(t,e,i,s,r,n,o){const h=new J(s,r,[o]),_=new Pt,l=[];for(let c=0;c<t;c++){const E=_.nextRange(e,i),f=_.nextRange(e,i),L=_.nextRange(0,s-E-1),g=_.nextRange(0,r-f-1),V=new U(L,g,E,f);if(l.some(u=>u.intersects(V)))continue;h.createRoom(V);const O=V.getCenter();if(l.length===0)o.x=O.x,o.y=O.y;else{const u=l[l.length-1].getCenter();_.nextRange(0,1)===1?(h.createHTunnel(u.x,O.x,u.y),h.createVTunnel(u.y,O.y,O.x)):(h.createVTunnel(u.y,O.y,u.x),h.createHTunnel(u.x,O.x,O.y))}pe(_,V,h,n),l.push(V)}return h}function pe(t,e,i,s){const r=t.nextRange(0,s);for(let n=0;n<r;n++){const o=t.nextRange(e.x+1,e.x2-1),h=t.nextRange(e.y+1,e.y2-1);i.getBlockingEntity(o,h)||(t.nextFloat()<.8?fe.spawn(i,o,h):Ee.spawn(i,o,h))}}const et=80,it=45,De=et,xe=it-7,Se=10,Ue=6,Ie=30,me=2,B=new bt(document.querySelector("canvas"),et,it),k=new Rt(B),lt=new I(40,20,"@",p.WHITE,"Player",!0,30,30,2,5),Be=ge(Ie,Ue,Se,De,xe,me,lt),b=new Z(lt,Be);b.log("Hello and welcome, adventurer, to yet another dungeon!",Xt);B.update=()=>{k.handleInput()||(B.isKeyPressed(A.VK_V)?k.add(new xt(new U(2,2,et-4,it-4),"Message Log",new K(void 0,void 0,void 0,b.messageLog.messages))):b.handleEvents(B)),b.render(B),k.draw()};
